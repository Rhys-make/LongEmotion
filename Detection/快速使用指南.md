# 🚀 LongEmotion 比赛文件 - 快速使用指南

**最后更新**: 2025-10-27  
**状态**: ✅ 已完成推理，可提交

---

## 📁 文件说明

```
COMPETITION_FILES/
├── model/
│   └── best_model.pt              # 训练好的模型（91.47%准确率）
│
├── test_data/
│   └── test.jsonl                 # 测试集（136个样本）
│
├── scripts/
│   ├── run_inference_final.py     # 主运行脚本
│   ├── inference_longemotion.py   # 推理核心逻辑
│   ├── convert_submission_format.py # 格式转换
│   └── detection_model.py         # 模型定义
│
├── submission/
│   └── Emotion_Detection_Result.jsonl  # 📤 提交文件
│
└── reports/
    ├── 项目最终进度报告.md        # 完整报告
    └── 项目自查报告.md            # 自查报告
```

---

## 🎯 提交文件

### 📤 立即提交
**文件路径**: `submission/Emotion_Detection_Result.jsonl`

**格式**:
```json
{"id": 0, "predicted_index": 24}
{"id": 1, "predicted_index": 4}
{"id": 2, "predicted_index": 11}
...
```

**统计信息**:
- ✅ 样本数: 136
- ✅ 平均置信度: 89.27%
- ✅ 格式正确

---

## 🔄 重新运行推理（如需要）

### 步骤1: 激活虚拟环境
```bash
# 从项目根目录运行
.\venv\Scripts\activate
```

### 步骤2: 进入Detection文件夹并运行推理
```bash
cd Detection
python scripts/run_inference_final.py
```

**输出**: 新的预测结果将保存到 `submission/predictions.jsonl`

### 步骤3: 转换格式（如需要）
```bash
# 在Detection/scripts文件夹内运行
cd scripts
python convert_submission_format.py
```

**输出**: 提交格式文件 `submission/Emotion_Detection_Result.jsonl`

---

## 📊 模型性能

| 指标 | 值 |
|------|-----|
| 验证准确率 | 91.47% |
| 平均置信度 | 89.27% |
| 推理时间 | 5-10分钟 |
| 测试样本 | 136个 |

### 情感分布
- love: 40.4%
- surprise: 22.8%
- fear: 13.2%
- anger: 11.8%
- sadness: 10.3%
- joy: 1.5%

---

## 🔍 文件详解

### model/best_model.pt
- **类型**: PyTorch模型权重
- **结构**: BERT-base-chinese + Linear分类器
- **训练数据**: 12,800条短文本
- **性能**: 91.47%验证准确率
- **位置**: `Detection/model/best_model.pt`

### test_data/test.jsonl
- **格式**: LongEmotion标准格式
- **样本**: 136个长文本
- **特点**: 每个样本30-34个段落
- **位置**: `Detection/test_data/test.jsonl`

### submission/Emotion_Detection_Result.jsonl
- **格式**: `{"id": int, "predicted_index": int}`
- **说明**: 
  - `id`: 样本编号 (0-135)
  - `predicted_index`: 预测的独特情感段落索引
- **位置**: `Detection/submission/Emotion_Detection_Result.jsonl`

---

## ⚙️ 技术细节

### 推理流程
1. 加载训练好的BERT模型（从 `model/best_model.pt`）
2. 读取测试集（从 `test_data/test.jsonl`，136个长文本样本）
3. 对每个样本的所有段落预测情感
4. 统计情感分布，找出只出现1次的（独特）
5. 输出该段落的索引到 `submission/` 文件夹

### 情感类别（6类）
- 0: sadness
- 1: joy
- 2: love
- 3: anger
- 4: fear
- 5: surprise

---

## 🐛 故障排除

### 问题1: 模型加载失败
**解决**: 
- 确保在Detection文件夹内运行脚本
- 脚本会自动使用相对路径定位文件
- 检查 `model/best_model.pt` 文件是否存在

### 问题2: 依赖缺失
**解决**: 
```bash
# 激活虚拟环境后安装依赖
pip install torch transformers tqdm
```

### 问题3: 内存不足
**解决**: 脚本默认使用CPU，内存需求较低（约2-4GB）

### 问题4: 找不到文件
**解决**: 
- 确保当前目录在 `Detection` 文件夹
- 使用 `cd Detection` 进入文件夹
- 检查文件结构是否完整

---

## 📝 注意事项

1. ✅ 提交文件已生成在 `submission/Emotion_Detection_Result.jsonl`
2. ⚠️ 运行脚本时必须在 `Detection` 文件夹内（或其子文件夹）
3. ⚠️ 如需重新推理，确保虚拟环境已激活
4. ⚠️ 模型文件较大（~400MB），请勿删除 `model/best_model.pt`
5. ✅ 所有路径已更新为Detection文件夹内的相对路径

---

## 🎓 学习资源

- **模型架构**: scripts/detection_model.py
- **推理逻辑**: scripts/inference_longemotion.py
- **完整报告**: reports/项目最终进度报告.md

---

## ✅ 检查清单

提交前确认:
- [ ] 文件格式正确（每行一个JSON对象）
- [ ] 包含136行（对应136个测试样本）
- [ ] `id`字段从0到135
- [ ] `predicted_index`是整数
- [ ] 文件编码UTF-8

---

## 🆘 需要帮助？

查看:
1. `reports/项目最终进度报告.md` - 完整技术报告
2. `reports/项目自查报告.md` - 项目自查说明
3. `README.md` - 快速概览
4. `scripts/` - 查看源代码了解实现细节

---

**祝您比赛顺利！** 🎉

