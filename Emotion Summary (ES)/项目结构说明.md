# Emotion Summary (ES) - 项目结构说明

## 📁 完整目录结构

```
Emotion Summary (ES)/
│
├── 📂 data/                          # 数据文件夹
│   ├── 📂 train/                    # 训练集文件夹（预留）
│   ├── 📂 validation/               # 验证集文件夹（预留）
│   ├── 📂 test/                     # 测试集文件夹（预留）
│   ├── 📄 train.jsonl              # 训练集数据
│   ├── 📄 validation.jsonl         # 验证集数据
│   ├── 📄 test.jsonl               # 测试集数据
│   └── 📄 README.md                # 数据说明文档
│
├── 📂 model/                         # 模型文件夹
│   ├── 📂 emotion_summary/          # 最终训练好的模型
│   │   ├── config.json
│   │   ├── pytorch_model.bin
│   │   ├── tokenizer.json
│   │   └── ...
│   ├── 📂 checkpoints/              # 训练检查点
│   │   ├── checkpoint-500/
│   │   ├── checkpoint-1000/
│   │   └── ...
│   └── 📄 README.md                # 模型说明文档
│
├── 📂 scripts/                       # 核心脚本文件夹
│   ├── 📄 __init__.py              # Python包初始化
│   ├── 📄 prepare_datasets.py      # 数据准备脚本
│   ├── 📄 model.py                 # 模型定义（EmotionSummaryModel类）
│   ├── 📄 train.py                 # 训练脚本
│   ├── 📄 inference.py             # 推理脚本
│   └── 📄 evaluate.py              # 评估脚本
│
├── 📂 config/                        # 配置文件夹
│   └── 📄 config.py                # 全局配置文件
│
├── 📂 submission/                    # 提交文件夹
│   └── 📄 submission.jsonl         # 比赛提交文件（待生成）
│
├── 📂 logs/                          # 日志文件夹
│   └── (训练日志，自动生成)
│
├── 📄 README.md                     # 项目主文档
├── 📄 QUICK_START.md                # 快速开始指南
├── 📄 INSTALLATION.md               # 安装指南
├── 📄 PROJECT_STATUS.md             # 项目状态文档
├── 📄 工作总结报告.md                # 详细工作总结
├── 📄 执行命令清单.md                # 命令执行清单
├── 📄 模型选择说明.md                # 模型选择详解
├── 📄 项目结构说明.md                # 本文档
├── 📄 requirements_es.txt           # Python依赖清单
└── 📄 .gitignore                    # Git忽略文件配置
```

## 🎯 与Detection项目的对比

### Detection项目结构
```
Detection/
├── detection/detection/     # 模型文件（嵌套结构）
├── model/detection/         # 另一个模型位置
├── scripts/                 # 脚本
├── test_data/              # 测试数据
└── submission/             # 提交文件
```

### ES项目结构（优化版）
```
Emotion Summary (ES)/
├── data/                   # 数据（分类清晰）
│   ├── train/
│   ├── validation/
│   └── test/
├── model/                  # 模型（单一位置）
│   ├── emotion_summary/   # 最终模型
│   └── checkpoints/       # 检查点
├── scripts/                # 脚本（功能完整）
├── config/                 # 配置（独立管理）
└── submission/            # 提交文件
```

**改进点：**
1. ✅ 避免嵌套结构，更清晰
2. ✅ data和model分离，更规范
3. ✅ config独立文件夹，易于管理
4. ✅ 文档更完善

## 📝 核心文件说明

### 1. 配置文件 (config/config.py)

**作用：** 集中管理所有配置参数

**包含内容：**
- 模型选择（LongT5-base）
- 路径配置
- 训练超参数
- 5个总结方面定义
- 生成策略配置
- 评估指标配置

**关键配置：**
```python
MODEL_NAME = "google/long-t5-tglobal-base"  # 模型
MAX_INPUT_LENGTH = 4096                      # 输入长度
BATCH_SIZE = 4                               # 批次大小
NUM_EPOCHS = 3                               # 训练轮数
```

---

### 2. 数据准备 (scripts/prepare_datasets.py)

**作用：** 下载和处理LongEmotion数据集

**功能：**
- 从Hugging Face下载ES任务数据
- 转换为JSONL格式
- 验证数据完整性
- 失败时创建示例数据

**输出：**
- `data/train.jsonl`
- `data/validation.jsonl`
- `data/test.jsonl`

---

### 3. 模型定义 (scripts/model.py)

**作用：** EmotionSummaryModel类封装

**支持模型：**
- LongT5（推荐）
- LED
- BART
- T5
- Pegasus

**主要方法：**
```python
model = EmotionSummaryModel()
summaries = model.generate_multi_aspect_summary(context)
```

---

### 4. 训练脚本 (scripts/train.py)

**作用：** 训练情绪总结模型

**流程：**
1. 加载数据集
2. 创建DataLoader
3. 训练循环
4. 验证和保存最佳模型

**输出：**
- `model/emotion_summary/` - 最佳模型
- `model/checkpoints/` - 训练检查点

---

### 5. 推理脚本 (scripts/inference.py)

**作用：** 对测试集生成总结

**流程：**
1. 加载训练好的模型
2. 读取测试集
3. 生成5个方面的总结
4. 保存为JSONL格式

**输出：**
- `submission/submission.jsonl`

---

### 6. 评估脚本 (scripts/evaluate.py)

**作用：** 评估生成质量

**指标：**
- ROUGE-1/2/L
- BLEU
- (可选)GPT-4o评估

---

## 📊 数据流程

```
1. 准备数据
   prepare_datasets.py
   ↓
   data/train.jsonl
   data/validation.jsonl
   data/test.jsonl

2. 训练模型
   train.py
   ↓
   model/emotion_summary/
   model/checkpoints/

3. 推理生成
   inference.py
   ↓
   submission/submission.jsonl

4. 评估结果
   evaluate.py
   ↓
   评估分数（终端输出）
```

## 🎯 5个总结方面

本项目需要从心理病理报告中总结以下5个方面：

1. **causes（原因）**
   - 心理问题的成因
   - 触发因素

2. **symptoms（症状）**
   - 患者的症状表现
   - 行为特征

3. **treatment_process（治疗过程）**
   - 具体的治疗方法
   - 治疗频率和周期

4. **illness_characteristics（疾病特征）**
   - 疾病的主要特点
   - 诊断分类

5. **treatment_effects（治疗效果）**
   - 治疗后的改善情况
   - 恢复程度

## 🚀 使用流程

### 第一步：安装依赖
```bash
pip install torch transformers datasets evaluate rouge-score nltk accelerate scikit-learn tqdm
```

### 第二步：准备数据
```bash
cd "Emotion Summary (ES)/scripts"
python prepare_datasets.py
```

### 第三步：训练模型
```bash
python train.py
```

### 第四步：生成总结
```bash
python inference.py
```

### 第五步：评估结果
```bash
python evaluate.py
```

## 📚 文档索引

| 文档 | 用途 |
|------|------|
| `README.md` | 项目完整介绍 |
| `QUICK_START.md` | 快速开始（5步） |
| `INSTALLATION.md` | 安装详细说明 |
| `执行命令清单.md` | 命令列表 |
| `模型选择说明.md` | 为什么选择LongT5 |
| `项目结构说明.md` | 本文档 |
| `工作总结报告.md` | 完整工作总结 |
| `PROJECT_STATUS.md` | 项目状态 |

## ⚙️ 关键配置位置

| 配置项 | 文件 | 行数（大约） |
|--------|------|------------|
| 模型选择 | `config/config.py` | 40 |
| 输入长度 | `config/config.py` | 87 |
| 批次大小 | `config/config.py` | 94 |
| 数据集名称 | `config/config.py` | 56 |
| 模型保存路径 | `config/config.py` | 41 |

## 🔍 常见问题

### Q: 模型文件在哪里？
A: `model/emotion_summary/` - 训练后会自动保存到这里

### Q: 如何更换模型？
A: 修改 `config/config.py` 中的 `MODEL_NAME`

### Q: 数据集文件在哪里？
A: `data/train.jsonl`、`data/validation.jsonl`、`data/test.jsonl`

### Q: 提交文件在哪里？
A: `submission/submission.jsonl` - 运行inference.py后生成

## 📈 项目特色

1. **清晰的文件夹结构** - 仿照Detection但更优化
2. **完整的文档系统** - 8个文档覆盖所有方面
3. **模块化设计** - 每个脚本功能独立
4. **配置集中管理** - 所有参数在config.py
5. **最佳模型选择** - LongT5专门用于长文本

---

**更新日期**: 2025-10-30  
**项目版本**: v1.0  
**推荐模型**: LongT5-base ⭐

