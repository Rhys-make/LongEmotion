# Emotion Summary (ES) - æ‰§è¡Œå‘½ä»¤æ¸…å•

## ğŸ“‹ æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤

### âœ… ç¬¬ä¸€æ­¥ï¼šå®‰è£…ä¾èµ–ï¼ˆå¿…éœ€ï¼‰

```bash
# æ ¸å¿ƒä¾èµ–ï¼ˆå¿…éœ€ï¼‰
pip install torch transformers datasets evaluate rouge-score nltk accelerate scikit-learn tqdm

# å¯é€‰ä¾èµ–
pip install matplotlib seaborn huggingface-hub pyyaml psutil
```

**æˆ–è€…ä½¿ç”¨requirementsæ–‡ä»¶ï¼š**

```bash
pip install -r "Emotion Summary (ES)/requirements_es.txt"
```

**ä¸‹è½½NLTKæ•°æ®ï¼š**

```bash
python -c "import nltk; nltk.download('punkt'); nltk.download('stopwords')"
```

---

### âœ… ç¬¬äºŒæ­¥ï¼šéªŒè¯å®‰è£…ï¼ˆæ¨èï¼‰

åˆ›å»ºä¸€ä¸ªæµ‹è¯•è„šæœ¬ `test_install.py`:

```python
import torch
import transformers
import datasets
import evaluate

print("âœ“ PyTorch:", torch.__version__)
print("âœ“ CUDA available:", torch.cuda.is_available())
print("âœ“ Transformers:", transformers.__version__)
print("âœ“ Datasets:", datasets.__version__)
print("âœ“ æ‰€æœ‰ä¾èµ–å®‰è£…æˆåŠŸï¼")
```

è¿è¡Œï¼š
```bash
python test_install.py
```

---

### âœ… ç¬¬ä¸‰æ­¥ï¼šå‡†å¤‡æ•°æ®

```bash
cd "Emotion Summary (ES)/scripts"
python prepare_datasets.py
```

**æ³¨æ„äº‹é¡¹ï¼š**
- é¦–æ¬¡è¿è¡Œéœ€è¦ä»Hugging Faceä¸‹è½½æ•°æ®
- å¦‚æœæ•°æ®é›†åç§°ä¸æ­£ç¡®ï¼Œä¼šåˆ›å»ºç¤ºä¾‹æ•°æ®
- ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸

**æ•°æ®é›†é…ç½®ä½ç½®ï¼š**
- æ–‡ä»¶ï¼š`config/config.py`
- å˜é‡ï¼š`DATASET_NAME` å’Œ `DATASET_SUBSET`

---

### âœ… ç¬¬å››æ­¥ï¼šè®­ç»ƒæ¨¡å‹

```bash
python train.py
```

**è®­ç»ƒå‚æ•°ï¼ˆåœ¨ config/config.py ä¸­è°ƒæ•´ï¼‰ï¼š**
- æ‰¹æ¬¡å¤§å°ï¼š`BATCH_SIZE = 4`
- è®­ç»ƒè½®æ•°ï¼š`NUM_EPOCHS = 3`
- å­¦ä¹ ç‡ï¼š`LEARNING_RATE = 5e-5`

**å¦‚æœæ˜¾å­˜ä¸è¶³ï¼š**
```python
# ä¿®æ”¹ config/config.py
BATCH_SIZE = 2
GRADIENT_ACCUMULATION_STEPS = 8
FP16 = True
```

**è®­ç»ƒæ—¶é—´ä¼°è®¡ï¼š**
- å°æ•°æ®é›†ï¼ˆ<1000æ ·æœ¬ï¼‰ï¼š1-2å°æ—¶
- ä¸­ç­‰æ•°æ®é›†ï¼ˆ1000-10000æ ·æœ¬ï¼‰ï¼š3-8å°æ—¶

---

### âœ… ç¬¬äº”æ­¥ï¼šç”Ÿæˆæ€»ç»“ï¼ˆæ¨ç†ï¼‰

```bash
python inference.py
```

**è¾“å‡ºæ–‡ä»¶ï¼š**
- `../submission/submission.jsonl`

**æ ¼å¼ï¼š**
```json
{
    "id": 0,
    "generated_summary": {
        "causes": "...",
        "symptoms": "...",
        "treatment_process": "...",
        "illness_characteristics": "...",
        "treatment_effects": "..."
    }
}
```

---

### âœ… ç¬¬å…­æ­¥ï¼šè¯„ä¼°ç»“æœ

```bash
python evaluate.py
```

**è¯„ä¼°æŒ‡æ ‡ï¼š**
- ROUGE-1/2/L
- BLEU

**é¢„æœŸåˆ†æ•°ï¼ˆå‚è€ƒï¼‰ï¼š**
- ROUGE-1: 0.35-0.45
- ROUGE-2: 0.15-0.25
- ROUGE-L: 0.30-0.40
- BLEU: 0.20-0.35

---

## ğŸ”§ å¸¸ç”¨è°ƒè¯•å‘½ä»¤

### æµ‹è¯•æ¨¡å‹åŠ è½½

```bash
cd "Emotion Summary (ES)/scripts"
python model.py
```

### æŸ¥çœ‹é…ç½®

```bash
python -c "import sys; sys.path.append('Emotion Summary (ES)'); from config.config import print_config; print_config()"
```

### æŸ¥çœ‹æ•°æ®æ ·æœ¬

```python
import json
with open('Emotion Summary (ES)/data/train.jsonl', 'r', encoding='utf-8') as f:
    sample = json.loads(f.readline())
    print(json.dumps(sample, indent=2, ensure_ascii=False))
```

---

## ğŸš¨ å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### é—®é¢˜1: CUDA out of memory

```python
# åœ¨ config/config.py ä¸­ä¿®æ”¹
BATCH_SIZE = 1
GRADIENT_ACCUMULATION_STEPS = 16
USE_GRADIENT_CHECKPOINTING = True
```

### é—®é¢˜2: æ•°æ®é›†ä¸‹è½½å¤±è´¥

1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤æ•°æ®é›†åç§°
3. ä½¿ç”¨ç¤ºä¾‹æ•°æ®æµ‹è¯•æµç¨‹

### é—®é¢˜3: æ¨¡å‹ä¸‹è½½æ…¢

è®¾ç½®Hugging Faceé•œåƒï¼š
```bash
export HF_ENDPOINT=https://hf-mirror.com
```

Windows PowerShell:
```powershell
$env:HF_ENDPOINT="https://hf-mirror.com"
```

### é—®é¢˜4: æ‰¾ä¸åˆ°æ¨¡å—

```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•
cd "Emotion Summary (ES)/scripts"

# æˆ–æ·»åŠ é¡¹ç›®è·¯å¾„
$env:PYTHONPATH="C:\Users\xsz20\project(self)\LongEmotion\Emotion Summary (ES)"
```

---

## ğŸ“Š å®Œæ•´æµç¨‹ï¼ˆä¸€é”®æ‰§è¡Œï¼‰

**æ³¨æ„ï¼šä»…åœ¨æ‰€æœ‰ä¾èµ–å®‰è£…å®Œæˆåä½¿ç”¨**

```bash
cd "Emotion Summary (ES)/scripts"
python prepare_datasets.py
python train.py
python inference.py
python evaluate.py
```

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•ï¼ˆä½¿ç”¨ç¤ºä¾‹æ•°æ®ï¼‰

å¦‚æœåªæƒ³æµ‹è¯•æµç¨‹ï¼Œä¸è¿›è¡Œå®Œæ•´è®­ç»ƒï¼š

```python
# åœ¨ config/config.py ä¸­ä¿®æ”¹
DEBUG_MODE = True
DEBUG_SAMPLES = 10
NUM_EPOCHS = 1
```

ç„¶åè¿è¡Œï¼š
```bash
cd "Emotion Summary (ES)/scripts"
python prepare_datasets.py
python train.py
python inference.py
```

---

## ğŸ“ è¾“å‡ºæ–‡ä»¶ä½ç½®

- **æ•°æ®é›†**: `Emotion Summary (ES)/data/`
  - `train.jsonl`
  - `validation.jsonl`
  - `test.jsonl`

- **æ¨¡å‹**: `Emotion Summary (ES)/model/best_model/`
  - `pytorch_model.bin`
  - `config.json`
  - `tokenizer.json`
  - ...

- **æäº¤æ–‡ä»¶**: `Emotion Summary (ES)/submission/`
  - `submission.jsonl`

- **æ—¥å¿—**: `Emotion Summary (ES)/logs/`

---

## âœ… æ£€æŸ¥æ¸…å•

æ‰§è¡Œå‰æ£€æŸ¥ï¼š
- [ ] è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
- [ ] æ‰€æœ‰ä¾èµ–å·²å®‰è£…
- [ ] CUDAå¯ç”¨ï¼ˆå¦‚ä½¿ç”¨GPUï¼‰
- [ ] è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆ>10GBï¼‰

æ‰§è¡Œåæ£€æŸ¥ï¼š
- [ ] æ•°æ®æ–‡ä»¶å·²ç”Ÿæˆ
- [ ] æ¨¡å‹æ–‡ä»¶å·²ä¿å­˜
- [ ] æäº¤æ–‡ä»¶å·²åˆ›å»º
- [ ] è¯„ä¼°åˆ†æ•°åˆç†

---

## ğŸ” ç›‘æ§è®­ç»ƒè¿›åº¦

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºï¼š
- å½“å‰epoch
- è®­ç»ƒæŸå¤±
- éªŒè¯æŸå¤±
- è¿›åº¦æ¡

**æœ€ä½³å®è·µï¼š**
- è§‚å¯ŸéªŒè¯æŸå¤±æ˜¯å¦ä¸‹é™
- å¦‚æœéªŒè¯æŸå¤±ä¸å†ä¸‹é™ï¼Œå¯ä»¥æå‰åœæ­¢
- ä¿å­˜æœ€ä½³æ¨¡å‹

---

## ğŸ“ è·å–å¸®åŠ©

- **README.md** - å®Œæ•´æ–‡æ¡£
- **QUICK_START.md** - å¿«é€Ÿå¼€å§‹
- **INSTALLATION.md** - å®‰è£…æŒ‡å—
- **PROJECT_STATUS.md** - é¡¹ç›®çŠ¶æ€
- **å·¥ä½œæ€»ç»“æŠ¥å‘Š.md** - è¯¦ç»†æŠ¥å‘Š

---

**ç¥è®­ç»ƒé¡ºåˆ©ï¼ğŸš€**

