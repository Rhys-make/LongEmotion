# LongEmotion 项目文件夹说明

**快速参考** | **生成时间**: 2025-10-28

---

## 📁 文件夹结构速览

```
LongEmotion/
├── Detection/              ✅ Detection任务（已完成，可提交）
├── classification/         ⚠️ 分类任务（脚本就绪，待执行）
├── qa/                    ⚠️ 问答任务（脚本就绪，待执行）
├── utils/                 📦 工具函数
├── venv/                  🐍 Python虚拟环境
├── requirements.txt       📋 项目依赖
├── Detection完成总结.md    📄 Detection任务总结
└── LongEmotion项目完整自查报告.md  📊 完整自查报告
```

---

## 1️⃣ Detection/ - 情感检测任务 ✅

### 📌 用途
在长文本的多个段落中，找出表达**独特情感**的那一个段落。

### 📊 状态
**✅ 已完成，可直接提交**

### 📁 核心文件
| 文件/文件夹 | 说明 | 状态 |
|------------|------|------|
| `model/best_model.pt` | 训练好的BERT模型 (1.17GB) | ✅ |
| `test_data/test.jsonl` | 官方测试集 (136个样本) | ✅ |
| `submission/Emotion_Detection_Result.jsonl` | **提交文件** ⭐ | ✅ 可提交 |
| `scripts/run_inference_final.py` | 主运行脚本 | ✅ |
| `快速使用指南.md` | 详细使用说明 | ✅ |

### 🎯 模型性能
- **验证准确率**: 91.47%
- **平均置信度**: 89.27%
- **情感类别**: 6类 (sadness, joy, love, anger, fear, surprise)

### 🚀 如何使用
```bash
# 提交文件路径（可直接使用）
Detection/submission/Emotion_Detection_Result.jsonl

# 如需重新推理
cd Detection
python scripts/run_inference_final.py
```

### 📄 相关文档
- `Detection/快速使用指南.md` - 完整使用指南
- `Detection/README.md` - 项目概览
- `Detection/reports/` - 技术报告和自查文档

---

## 2️⃣ classification/ - 情绪分类任务 ⚠️

### 📌 用途
根据**上下文**、**主语**和**选项列表**进行情绪分类。

### 📊 状态
**⚠️ 脚本就绪，数据未准备，模型未训练**

### 📁 核心文件
| 文件/文件夹 | 说明 | 状态 |
|------------|------|------|
| `scripts/prepare_datasets.py` | 数据准备脚本 ⭐ | ✅ 就绪 |
| `scripts/train.py` | 训练脚本 | ✅ 就绪 |
| `scripts/inference.py` | 推理脚本 | ✅ 就绪 |
| `scripts/classification_model.py` | 模型定义 | ✅ 就绪 |
| `scripts/README.md` | 详细说明 | ✅ |
| `data/` | 数据目录 | ❌ 不存在 |

### 📝 数据格式
```json
{
    "id": 0,
    "Context": "I love this new feature!",
    "Subject": "I",
    "Choices": ["admiration", "amusement", "anger", "..."],
    "Answer": "admiration"
}
```

### 🎯 数据来源
- **训练/验证**: GoEmotions 数据集（需下载）
- **测试**: LongEmotion 数据集

### 🚀 执行步骤
```bash
# 步骤1: 准备数据 (15-30分钟)
python classification/scripts/prepare_datasets.py

# 步骤2: 训练模型 (2-4小时，GPU推荐)
python classification/scripts/train.py

# 步骤3: 推理测试集
python classification/scripts/inference.py
```

### 📄 相关文档
- `classification/scripts/README.md` - 完整使用说明
- `classification/scripts/MEMORY_OPTIMIZATION_GUIDE.md` - 内存优化指南

---

## 3️⃣ qa/ - 问答任务 ⚠️

### 📌 用途
基于**长篇心理学文献**回答问题，考验模型的长上下文理解能力。

### 📊 状态
**⚠️ 脚本就绪，数据未准备，模型未训练**

### 📁 核心文件
| 文件/文件夹 | 说明 | 状态 |
|------------|------|------|
| `scripts/prepare_datasets.py` | 数据准备脚本 ⭐ | ✅ 就绪 |
| `scripts/train.py` | 训练脚本 | ✅ 就绪 |
| `scripts/inference.py` | 推理脚本 | ✅ 就绪 |
| `scripts/qa_model.py` | QA模型定义 | ✅ 就绪 |
| `README.md` | 任务说明 | ✅ |
| `TRAINING_GUIDE.md` | 训练指南 | ✅ |
| `data/` | 数据目录 | ❌ 不存在 |

### 📝 数据格式
```json
{
  "id": 0,
  "problem": "基于以下心理学文献，问题是：...",
  "context": "一段长篇心理学或社会科学文献...",
  "answer": "因为..."
}
```

### 🎯 模型推荐
| 模型 | 适用场景 | 上下文长度 |
|------|---------|-----------|
| BERT-base | 基础测试 | 512 tokens |
| **Longformer** | **推荐** | 4096 tokens |
| Mistral-7B | 效果最佳 | 32k tokens |

### 🚀 执行步骤
```bash
# 步骤1: 准备数据
python qa/scripts/prepare_datasets.py

# 步骤2: 训练模型（推荐Longformer）
python qa/scripts/train.py \
  --model_name allenai/longformer-base-4096 \
  --max_length 2048 \
  --batch_size 2 \
  --gradient_accumulation_steps 8

# 步骤3: 推理测试集
python qa/scripts/inference.py
```

### 📄 相关文档
- `qa/README.md` - 任务概览
- `qa/TRAINING_GUIDE.md` - 详细训练指南
- `qa/scripts/README_SAFE_TRAINING.md` - 安全训练指南

---

## 4️⃣ utils/ - 工具函数 📦

### 📌 用途
提供通用的工具函数和辅助功能。

### 📁 当前文件
| 文件 | 说明 | 状态 |
|------|------|------|
| `preprocess.py` | 预处理工具 | ✅ |

### ⚠️ 注意
根据git status，以下文件已删除：
- `__init__.py`
- `evaluator.py`
- `trainer.py`

这些功能可能已重构到各任务文件夹中。

---

## 5️⃣ venv/ - Python虚拟环境 🐍

### 📌 用途
隔离项目依赖，避免包冲突。

### 📊 配置
- **Python版本**: 3.13
- **主要依赖**: 见 `requirements.txt`

### 🚀 激活方式
```bash
# Windows
.\venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

---

## 📋 requirements.txt - 项目依赖

### 核心依赖
```
torch>=2.0.0              # 深度学习框架
transformers>=4.35.0      # 预训练模型
datasets>=2.14.0          # 数据集加载
numpy>=1.24.0             # 数值计算
scikit-learn>=1.3.0       # 评估指标
```

### 安装方式
```bash
pip install -r requirements.txt
```

---

## 📊 任务对比表

| 特性 | Detection | Classification | QA |
|------|-----------|----------------|-----|
| **状态** | ✅ 完成 | ⚠️ 待开始 | ⚠️ 待开始 |
| **任务类型** | 独特情感检测 | 多类情绪分类 | 长文本问答 |
| **输入** | 长文本+多段落 | 上下文+主语+选项 | 问题+长文献 |
| **输出** | 段落索引 | 情绪标签 | 答案文本 |
| **评估指标** | 准确率 | F1分数 | F1分数 |
| **数据就绪** | ✅ | ❌ | ❌ |
| **模型就绪** | ✅ | ❌ | ❌ |
| **提交就绪** | ✅ | ❌ | ❌ |
| **预计时间** | - | 3-5小时 | 4-6小时 |

---

## 🎯 快速操作指南

### 场景1: 提交Detection结果
```bash
# 文件位置
Detection/submission/Emotion_Detection_Result.jsonl

# 格式验证
已验证 ✅ - 136行，格式正确
```

### 场景2: 开始Classification任务
```bash
# 1. 激活环境
.\venv\Scripts\activate

# 2. 准备数据
python classification/scripts/prepare_datasets.py

# 3. 训练
python classification/scripts/train.py
```

### 场景3: 开始QA任务
```bash
# 1. 激活环境
.\venv\Scripts\activate

# 2. 准备数据
python qa/scripts/prepare_datasets.py

# 3. 训练 (Longformer)
python qa/scripts/train.py \
  --model_name allenai/longformer-base-4096 \
  --max_length 2048
```

### 场景4: 重新运行Detection推理
```bash
# 1. 激活环境
.\venv\Scripts\activate

# 2. 进入文件夹
cd Detection

# 3. 运行推理
python scripts/run_inference_final.py
```

---

## 🔍 重要文件位置速查

### 提交文件
- **Detection**: `Detection/submission/Emotion_Detection_Result.jsonl` ✅
- **Classification**: 待生成 ⚠️
- **QA**: 待生成 ⚠️

### 配置文件
- **依赖清单**: `requirements.txt`
- **Classification配置**: `classification/config.py`

### 文档文件
- **项目自查**: `LongEmotion项目完整自查报告.md`
- **Detection总结**: `Detection完成总结.md`
- **本说明**: `项目文件夹说明.md`

### 模型文件
- **Detection模型**: `Detection/model/best_model.pt` (1.17GB)
- **其他模型**: 待训练

---

## ⚠️ 注意事项

### Git状态
```
✅ 已完成: Detection文件夹
⚠️ 未跟踪: Detection/ (需要git add)
⚠️ 已删除: LICENSE, models/, utils/ (部分文件)
```

### 存储需求
- **当前使用**: ~1.2 GB
- **预计总需求**: ~3-4 GB (如果训练所有任务)

### 时间评估
| 任务 | GPU | CPU |
|------|-----|-----|
| Detection推理 | 5-10分钟 | 10-15分钟 |
| Classification全流程 | 3-5小时 | 8-12小时 |
| QA全流程 | 4-6小时 | 12-24小时 |

---

## 📞 需要帮助？

### Detection任务
查看: `Detection/快速使用指南.md`

### Classification任务
查看: `classification/scripts/README.md`

### QA任务
查看: `qa/README.md` 和 `qa/TRAINING_GUIDE.md`

### 项目整体
查看: `LongEmotion项目完整自查报告.md`

---

**文档生成完毕！** 📚

**关键信息**:
- ✅ Detection已完成，可立即提交
- ⚠️ Classification和QA需要从数据准备开始
- 📊 所有脚本就绪，按步骤执行即可
- 🎯 建议优先提交Detection，再根据时间决定其他任务

